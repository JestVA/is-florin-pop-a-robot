<!DOCTYPE html>
<html lang="en" prefix="og: https://ogp.me/ns#">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>ü§ñ Is Florin Pop A Robot? Beep Beep</title>
		<link href="https://fonts.googleapis.com/css?family=Lato:300,400" rel="stylesheet">
		<link href="./style.css" rel="stylesheet">
		<script type="text/javascript" src="./interactive.js"></script>
	</head>

	<body>
		<div class="page-wrapper">
			<section class="content-container">
				<!-- shiny button that spills out the facts  -->
				<h1>This Button Does Nothing.. or Everything</h1>
				<button class="btn" onclick="withProxyFindAnswer()">I want to know! ü§∑‚Äç‚ôÇÔ∏è</button>
				<div id="answer"></div>
			</section>
			<footer class="credits">
				<a href="https://www.twitter.com/COERCITON" target="_blank">Say hi on Twitter</a>
				<span>üìç</span>
				<a href="https://www.github.com/JestVA" target="_blank">Visit project on GitHub</a>
			</footer>
		</div>
	</body>

	<script type="text/javascript">

		let loadingRequest = false;
		let consumedAnswers = 0;
		
		async function withProxyFindAnswer()
		{

			const answerDOMElement = document.getElementById('answer');

			const interactiveAnswer = setInterval(makeWaitLessBoring, 1000);
			
			loadingRequest = true;
			
			const withProxy = await fetch('/.netlify/functions/proxy-request?yt=true&twitter=true');
			
			const res = await withProxy.json();
			
			loadingRequest = false;
			
			if(res.error)
			{
				clearInterval(interactiveAnswer);

				resetAnswerDiv(answerDOMElement);
				
				appendTextNodesToAnswer(answerDOMElement, res.message, true);
			}

		}

		function makeWaitLessBoring(element)
		{
			if(! loadingRequest)
				return;
			if(consumedAnswers >= whileFetching.length)
				return;
			
			appendTextNodesToAnswer(element, whileFetching[0]);
			consumedAnswers++;
		}

		function resetAnswerDiv(element)
		{
			element.innerHTML = "";
		}

		function appendTextNodesToAnswer(node, text, error = false)
		{
			if(error)
				node.innerHTML = "";
			
			const p = document.createElement("p");
			const t = document.createTextNode(text);
			p.appendChild(t);
			node.appendChild(p);
			node.className = "show";
		}
	</script>
</html>
